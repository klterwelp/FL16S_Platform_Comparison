---
title: "Alpha Diversity Analysis"
author: "Kat Terwelp"
format: pdf
editor: visual
---

### Plots 

```{r}
library(tidyverse) # work with tibbles etc
library(phyloseq) # work with phyloseq objects
library(microViz) # useful package for visualizations
library(vegan) # for rarecurve

# set file paths
in_path <- "../intermediates/RDS"
all_ps_path <- file.path(in_path, "all_ps.RDS")
out_path <- "../figures"

# set theme 
theme_set(theme_bw()) # slightly clearer axes for facets

# source common plot functions
source("plot_utils.r", local = knitr::knit_global())
```

```{r}
# rarecurve
set.seed(123)
tidy_rare <- rarecurve(as.data.frame(t(otu_table(all_ps_count))), step = 1000, tidy = TRUE)

tidy_rare <- tidy_rare %>%
  separate(Site, into = c("part1", "part2", "analysis"), sep = "\\.", remove = FALSE) %>%
  mutate(sampleID = paste(part1, part2, sep = ".")) %>%
  select(-part1, -part2)  # drop intermediate columns
```

```{r}
tidy_rare %>% 
  filter(Sample < 100000) %>% 
  ggplot(aes(x = Sample, y = Species, color = analysis)) +
    geom_point(size = 0.5) +
    facet_wrap(~ analysis)
```
